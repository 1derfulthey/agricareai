<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
<meta name="description" content="AgriCare AI ‚Äî ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏°‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡∏î‡πâ‡∏ß‡∏¢ Teachable Machine" />
<title>AgriCare AI - ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏¢‡∏Å‡πÅ‡∏°‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä</title>

<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå±</text></svg>">

<!-- Fonts + Icons -->
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

<!-- TFJS + Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
:root{
  --primary:#2E7D32;--primary-dark:#1B5E20;--primary-light:#43A047;
  --accent:#8BC34A;--secondary:#FF9800;
  --bg:#F6FBF6;--surface:#fff;--ink:#1d1d1d;--ink-2:#596166;
  --outline:#E5EAE5;--error:#D32F2F;--ok:#2e7d32;
  --shadow:0 6px 18px rgba(0,0,0,.08);--shadow-sm:0 3px 10px rgba(0,0,0,.06);
  --r-sm:10px;--r-md:18px;--r-lg:26px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:'Sarabun',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Kanit',sans-serif;
  line-height:1.7;
}

/* Header */
.header{
  position:sticky;top:0;z-index:20;
  background:linear-gradient(0deg,var(--primary-dark),var(--primary));
  color:#fff;box-shadow:var(--shadow);
}
.header-inner{max-width:1200px;margin:auto;display:flex;align-items:center;gap:16px;padding:14px 18px}
.brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:1.55rem}
.brand i{font-size:1.4em}

/* Top nav */
.nav{
  max-width:1200px;margin:10px auto 0;display:flex;gap:10px;justify-content:center;
  background:#e8f5e9;border-radius:999px;padding:8px 10px;box-shadow:var(--shadow-sm)
}
.nav a{
  display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border-radius:999px;
  text-decoration:none;color:var(--primary-dark);font-weight:700;font-size:1.02rem;
  transition:.25s;white-space:nowrap
}
.nav a i{font-size:1.1rem}
.nav a.active, .nav a:hover{
  background:linear-gradient(135deg,var(--primary),var(--primary-light));
  color:#fff;transform:translateY(-1px)
}

/* Container */
.container{max-width:1200px;margin:18px auto;padding:0 16px}

/* Hero */
.hero{
  background:var(--surface);border-radius:var(--r-lg);box-shadow:var(--shadow);
  padding:28px 18px 32px;border:1px solid var(--outline);
}
.hero h1{
  font-family:'Kanit',sans-serif;color:var(--primary-dark);
  text-align:center;font-size:2.4rem;margin:.3rem 0 10px
}
.hero p{color:var(--ink-2);text-align:center;margin:0 0 24px}

/* Grid 7 features */
.grid{
  display:grid;gap:18px;justify-content:center;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
}
.card{
  background:var(--surface);border:1px solid var(--outline);border-radius:18px;
  box-shadow:var(--shadow-sm);padding:22px 16px;text-align:center;cursor:pointer;
  transition:.25s;min-height:160px;display:flex;flex-direction:column;align-items:center;justify-content:center
}
.card:hover{transform:translateY(-4px);box-shadow:var(--shadow)}
.card i{font-size:2.2rem;margin-bottom:10px}
.card h3{margin:0;font-family:'Kanit',sans-serif}

/* Sections */
.page-section{display:none;animation:fade .35s ease}
.page-section.active{display:block}
@keyframes fade{from{opacity:0;translate:0 8px}to{opacity:1;translate:0 0}}

/* Analysis & shared */
.section-title{display:flex;align-items:center;gap:10px;color:var(--primary-dark)}
.section-title i{background:#e9f6ea;width:44px;height:44px;border-radius:50%;display:grid;place-items:center;font-size:1.2rem}
.panel{background:var(--surface);border:1px solid var(--outline);border-radius:var(--r-lg);box-shadow:var(--shadow);padding:20px}

/* Image box */
.image-box{
  width:100%;max-width:720px;height:430px;margin:auto;border:2px dashed #cfe4cf;border-radius:16px;
  display:grid;place-items:center;overflow:hidden;background:#fbfdfb;position:relative
}
.image-box video,.image-box img{width:100%;height:100%;object-fit:cover}
.placeholder{text-align:center;color:#9aa7a1}
.placeholder i{font-size:3.2rem;margin-bottom:10px}

/* Big buttons */
.actions{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:18px}
.btn{
  --bg:var(--primary);--bg2:var(--primary-light);
  background:linear-gradient(135deg,var(--bg),var(--bg2));
  color:#fff;border:none;border-radius:999px;padding:14px 22px;font-weight:700;
  font-size:1.05rem;display:inline-flex;gap:10px;align-items:center;cursor:pointer;
  box-shadow:var(--shadow-sm);transition:.2s;min-width:180px;justify-content:center
}
.btn i{font-size:1.05rem}
.btn:hover{transform:translateY(-2px)}
.btn.secondary{--bg:#FF9800;--bg2:#FFB74D}
.btn.info{--bg:#1976d2;--bg2:#64B5F6}
.btn.danger{--bg:#e53935;--bg2:#ef5350}
.btn.gray{--bg:#90A4AE;--bg2:#B0BEC5}

/* Loading */
.loading{display:none;align-items:center;gap:10px;justify-content:center;margin:14px 0;color:var(--ink-2)}
.loading .spin{
  width:28px;height:28px;border:4px solid #e8f1e8;border-top-color:var(--primary);border-radius:50%;
  animation:rot .9s linear infinite
}
@keyframes rot{to{transform:rotate(360deg)}}

/* Result */
.result-grid{display:grid;grid-template-columns:1.1fr 1.6fr;gap:24px}
.result-img{border-radius:16px;overflow:hidden;border:1px solid var(--outline);box-shadow:var(--shadow-sm)}
.result-img img{display:block;width:100%;height:auto}
.badge{display:inline-flex;align-items:center;gap:8px;background:#ffeaea;color:#b71c1c;padding:8px 12px;border-radius:999px;font-weight:700;margin-bottom:8px}
.badge.beneficial{background:#e8f5e9;color:#1b5e20}
.badge.healthy{background:#e8f5e9;color:#1b5e20}
.badge.disease{background:#fff3e0;color:#e65100}
.badge.unknown{background:#fff8e1;color:#8d6e00}

.result-title{font-family:'Kanit',sans-serif;font-size:2rem;margin:.4rem 0 .6rem}
.conf-row{display:flex;align-items:center;gap:10px;margin:10px 0 6px}
.conf-row i{color:#2e7d32}
.conf-label{font-weight:700}
.progress{height:26px;border-radius:13px;background:#e9ecef;overflow:hidden;box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}
.progress>span{display:block;height:100%;width:0;background:repeating-linear-gradient(45deg,#9CCC65,#689F38 15px,#7CB342 15px,#7CB342 30px);transition:width .9s cubic-bezier(.22,.61,.36,1)}

.block h4{display:flex;align-items:center;gap:10px;margin:18px 0 10px;color:var(--primary-dark)}
.block h4 i{color:var(--primary)}
.list{list-style:none;padding:0;margin:0}
.list li{display:flex;align-items:center;gap:10px;margin:8px 0}
.list li i{color:var(--ok)}
.near li i{color:#7cb342}
.near li{margin:6px 0}

/* Unknown box */
.unknown-box{
  background:#fff7e6;border:1px solid #ffe0b2;padding:16px;border-radius:14px;margin-top:14px;color:#6d4c41
}
.unknown-box .adv{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
.unknown-box .adv i{margin-top:3px;color:#ff9800}

/* Footer */
footer{max-width:1200px;margin:24px auto;padding:16px;color:#62706b;text-align:center}

/* Forms */
.form{max-width:640px;margin:auto}
.form .group{margin:14px 0}
.form label{font-weight:700;margin-bottom:6px;display:block}
.form input,.form select,.form textarea{
  width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--outline);background:#fafdf9;font-size:1rem
}
.form textarea{min-height:110px;resize:vertical}

/* Sweet-like modal (‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ direct contribution) */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
.modal .box{background:#fff;border-radius:18px;box-shadow:var(--shadow);max-width:460px;width:92%;padding:20px 22px;text-align:center}
.modal .box h3{margin:8px 0 6px;font-family:'Kanit',sans-serif;color:var(--primary-dark)}
.modal .box p{margin:0 0 12px;color:#54635c}
.modal .box .ok{margin-top:6px}

/* --- UI tweaks for Direct Contribution only --- */
.center-note{ text-align:center; color:#5b6a61; margin:0 0 8px; }
.upload-wrap{ display:flex; flex-direction:column; align-items:center; }
#dc-preview{ display:none; max-width:420px; width:100%; border-radius:14px; margin:12px auto; border:1px solid var(--outline) }
.consent-box{
  display:flex; align-items:center; justify-content:center; gap:10px;
  background:#e8f5e9; border:1px dashed #a5d6a7; border-radius:14px; padding:12px;
  color:#1b5e20; font-weight:700;
}

@media (max-width:1000px){ .result-grid{grid-template-columns:1fr} }
@media (max-width:640px){
  .brand{font-size:1.3rem}
  .nav{flex-wrap:wrap}
  .nav a{font-size:1rem;padding:12px 18px}
  .hero h1{font-size:2rem}
  .image-box{height:360px}
  .btn{min-width:46%;padding:14px 16px}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="brand"><i class="fa-solid fa-seedling"></i> AgriCare AI</div>
  </div>
</header>

<!-- ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å -->
<nav class="nav" id="top-nav" style="display:none">
  <a href="#" data-target="home-page" class="active"><i class="fa-solid fa-house"></i>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  <a href="#" data-target="analysis-page"><i class="fa-solid fa-magnifying-glass"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</a>
  <a href="#" data-target="result-page"><i class="fa-solid fa-chart-pie"></i>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</a>
  <a href="#" data-target="report-feedback-page"><i class="fa-solid fa-heart"></i>‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤</a>
</nav>

<main class="container">

  <!-- HOME -->
  <section id="home-page" class="page-section active">
    <div class="hero">
      <h1>‡∏î‡∏ß‡∏á‡∏ï‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h1>
      <p>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡∏•‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ AI ‚Äî ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
      <div class="grid">
        <a class="card feature" data-model="insect"><i class="fa-solid fa-bug" style="color:#d6741e"></i><h3>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏°‡∏•‡∏á</h3></a>
        <a class="card feature" data-model="corn"><i class="fa-solid fa-seedling" style="color:#f3b300"></i><h3>‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î</h3></a>
        <a class="card feature" data-model="sugarcane"><i class="fa-solid fa-leaf" style="color:#7CB342"></i><h3>‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏≠‡πâ‡∏≠‡∏¢</h3></a>
        <a class="card feature" data-model="cassava"><i class="fa-solid fa-wheat-awn" style="color:#6D4C41"></i><h3>‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á</h3></a>
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Direct Contribution -->
        <a class="card" id="contribute-data-home"><i class="fa-solid fa-robot" style="color:#0ea5e9"></i><h3>‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI</h3></a>
        <a class="card" id="usage-btn"><i class="fa-solid fa-circle-question" style="color:#3F51B5"></i><h3>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3></a>
        <a class="card" id="about-btn"><i class="fa-solid fa-circle-info" style="color:#8E24AA"></i><h3>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h3></a>
      </div>

      <div class="panel" style="margin-top:18px;text-align:center;color:#2e7d32">
        ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äò‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‚Äô ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      </div>
    </div>
  </section>

  <!-- ANALYSIS (‡πÄ‡∏î‡∏¥‡∏°) -->
  <section id="analysis-page" class="page-section">
    <h2 class="section-title"><i class="fa-solid fa-camera-retro"></i> <span id="analysis-title">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span></h2>
    <div class="panel">
      <div class="image-box" id="image-box">
        <div class="placeholder" id="placeholder"><i class="fa-regular fa-image"></i><div id="instruction">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û</div></div>
        <video id="webcam" autoplay playsinline style="display:none"></video>
        <img id="preview" alt="" style="display:none" />
      </div>

      <div class="loading" id="loading"><div class="spin"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•/‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á‚Ä¶</div>

      <div class="actions">
        <button class="btn" id="capture"><i class="fa-solid fa-camera"></i>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</button>
        <button class="btn secondary" id="upload"><i class="fa-solid fa-upload"></i>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û</button>
        <input type="file" id="file-input" accept="image/*" hidden>
        <button class="btn info" id="analyze" style="display:none"><i class="fa-solid fa-magnifying-glass-chart"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û</button>
        <button class="btn gray" id="recapture" style="display:none"><i class="fa-solid fa-arrows-rotate"></i>‡∏ñ‡πà‡∏≤‡∏¢/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
      </div>
    </div>
  </section>

  <!-- RESULT (‡πÄ‡∏î‡∏¥‡∏°) -->
  <section id="result-page" class="page-section">
    <h2 class="section-title"><i class="fa-solid fa-chart-pie"></i> ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
    <div class="panel">
      <div class="result-grid">
        <div class="result-img"><img id="result-image" alt="‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"></div>
        <div>
          <span id="result-type" class="badge unknown"><i class="fa-solid fa-tag"></i><b>‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</b></span>
          <div class="result-title" id="result-name">‚Äî</div>

          <div class="conf-row">
            <i class="fa-solid fa-chart-line"></i>
            <span class="conf-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à:</span>
            <b id="result-confidence">‚Äî</b>
          </div>
          <div class="progress"><span id="conf-fill"></span></div>

          <div class="block" id="result-info" style="margin-top:8px"></div>

          <div class="block" id="nearby-block" style="margin-top:10px">
            <h4><i class="fa-solid fa-list-check"></i>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á</h4>
            <ul class="list near" id="nearby-list"></ul>
          </div>

          <div class="actions" style="margin-top:16px">
            <button class="btn" id="go-report"><i class="fa-solid fa-heart"></i>‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤</button>
            <button class="btn danger" id="again"><i class="fa-solid fa-magnifying-glass"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- REPORT ‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡πÄ‡∏î‡∏¥‡∏°) -->
  <section id="report-feedback-page" class="page-section">
    <h2 class="section-title"><i class="fa-solid fa-heart"></i> ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤</h2>
    <div class="panel form">
      <img id="report-img" style="display:block;max-width:360px;width:100%;border-radius:14px;margin:auto 0 14px;border:1px solid var(--outline)"/>
      <div class="group">
        <label>‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å AI</label>
        <div class="panel" id="ai-summary" style="padding:12px;font-weight:700;color:var(--primary-dark)">‚Äî</div>
      </div>
      <div class="group">
        <label for="fix-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)</label>
        <input id="fix-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡∏•‡∏á/‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á">
      </div>
      <div class="group">
        <label for="desc">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
        <textarea id="desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏•‡πà‡∏≤‡∏á ‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô ‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏Å‡∏±‡∏î‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏Ç‡∏≠‡∏ö‡πÉ‡∏ö ‡∏Ø‡∏•‡∏Ø"></textarea>
      </div>
      <div class="actions">
        <button class="btn gray" id="back-to-result"><i class="fa-solid fa-arrow-left"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        <button class="btn" id="send-report"><i class="fa-solid fa-paper-plane"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</button>
      </div>
    </div>
  </section>

  <!-- NEW: DIRECT CONTRIBUTION ‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô -->
  <section id="direct-contrib-page" class="page-section">
    <h2 class="section-title"><i class="fa-solid fa-heart-circle-plus"></i> ‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI (‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á)</h2>
    <div class="panel form">
      <p class="center-note">
        ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•
      </p>

      <div class="group">
        <label for="dc-category">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏†‡∏≤‡∏û</label>
        <select id="dc-category">
          <option value="insect">‡πÅ‡∏°‡∏•‡∏á</option>
          <option value="corn">‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î</option>
          <option value="sugarcane">‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏≠‡πâ‡∏≠‡∏¢</option>
          <option value="cassava">‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á</option>
          <option value="other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
        </select>
      </div>

      <div class="group upload-wrap">
        <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î/‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</label>
        <div class="actions" style="justify-content:center">
          <button class="btn secondary" id="dc-upload"><i class="fa-solid fa-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û</button>
          <input type="file" id="dc-file" accept="image/*" capture="environment" hidden>
          <button class="btn gray" id="dc-clear" style="display:none"><i class="fa-solid fa-eraser"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ</button>
        </div>
        <img id="dc-preview"/>
      </div>

      <div class="group">
        <label for="dc-true">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)</label>
        <input id="dc-true" placeholder="‡πÄ‡∏ä‡πà‡∏ô Striped Flea Beetle / Leaf Blight ‡∏Ø‡∏•‡∏Ø">
      </div>

      <div class="group">
        <label for="dc-note">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
        <textarea id="dc-note" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏û ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏û‡∏ö ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡πÄ‡∏ß‡∏•‡∏≤ ‡∏â‡∏µ‡∏î‡∏™‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏Ø‡∏•‡∏Ø"></textarea>
      </div>

      <!-- Consent, centered & emphasized -->
      <div class="group">
        <div class="consent-box">
          <input type="checkbox" id="dc-consent">
          <label for="dc-consent" style="margin:0">‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI</label>
        </div>
      </div>

      <div class="actions">
        <button class="btn gray" id="dc-back"><i class="fa-solid fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        <button class="btn" id="dc-send"><i class="fa-solid fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤</button>
      </div>
    </div>
  </section>

</main>

<footer>&copy; 2024 AgriCare AI Project ‚Äî ‡πÉ‡∏ä‡πâ Google Apps Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</footer>

<!-- Success Modal (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Direct Contribution ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
<div class="modal" id="dc-modal">
  <div class="box">
    <div style="font-size:2rem;line-height:1">üéâ</div>
    <h3>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
    <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI! ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•</p>
    <button class="btn ok" id="dc-ok"><i class="fa-solid fa-check"></i> ‡∏ï‡∏Å‡∏•‡∏á</button>
  </div>
</div>

<script>
/* ================== MODEL & DATA (‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) =================== */
const MODELS_INFO = {
  insect   : { url:'https://teachablemachine.withgoogle.com/models/gCL-xqZ8C/', title:'‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏°‡∏•‡∏á', instruction:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏°‡∏•‡∏á' },
  corn     : { url:'https://teachablemachine.withgoogle.com/models/RfjRGiUuH/', title:'‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î', instruction:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î' },
  sugarcane: { url:'https://teachablemachine.withgoogle.com/models/dkwga_Se1/', title:'‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏≠‡πâ‡∏≠‡∏¢', instruction:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏≠‡πâ‡∏≠‡∏¢' },
  cassava  : { url:'https://teachablemachine.withgoogle.com/models/53Vfkzth9/', title:'‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á', instruction:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á' }
};

const RESULTS_DATA = {
  "Lady Beetles - ‡∏î‡πâ‡∏ß‡∏á‡πÄ‡∏ï‡πà‡∏≤‡∏•‡∏≤‡∏¢":{ type:"beneficial", label:"‡πÅ‡∏°‡∏•‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå",
    info:"‡∏ï‡∏±‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏¢‡∏Å‡∏¥‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡πâ‡∏¢‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡∏•‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥",
    management:["‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡πÅ‡∏´‡∏•‡πà‡∏á‡∏≠‡∏≤‡∏®‡∏±‡∏¢","‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°","‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏î‡∏≠‡∏Å‡∏•‡πà‡∏≠‡πÅ‡∏°‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå"] },
  "Green Lacewing - ‡πÅ‡∏°‡∏•‡∏á‡∏ä‡πâ‡∏≤‡∏á‡∏õ‡∏µ‡∏Å‡πÉ‡∏™":{ type:"beneficial", label:"‡πÅ‡∏°‡∏•‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå",
    info:"‡∏ï‡∏±‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏•‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏µ‡πâ‡∏¢‡∏≠‡πà‡∏≠‡∏ô ‡πÑ‡∏£‡πÅ‡∏î‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡∏•‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å",
    management:["‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏ß‡πâ‡∏≤‡∏á","‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏ö‡∏ã‡πà‡∏≠‡∏ô","‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ï‡∏±‡∏ß‡∏´‡πâ‡∏≥‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö IPM"] },
  "Stink Bug - ‡∏°‡∏ß‡∏ô‡∏û‡∏¥‡∏Ü‡∏≤‡∏ï":{ type:"beneficial", label:"‡πÅ‡∏°‡∏•‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå",
    info:"‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡∏´‡∏ô‡∏≠‡∏ô‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡πà‡∏Ç‡∏≠‡∏á‡πÅ‡∏°‡∏•‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏ô‡∏¥‡∏î",
    management:["‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô","‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏Å‡∏±‡∏ô‡∏ä‡∏ô"] },
  "Assassin Bug - ‡∏°‡∏ß‡∏ô‡πÄ‡∏û‡∏ä‡∏å‡∏Ü‡∏≤‡∏ï":{ type:"beneficial", label:"‡πÅ‡∏°‡∏•‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå",
    info:"‡πÉ‡∏ä‡πâ‡∏õ‡∏≤‡∏Å‡πÅ‡∏ó‡∏á‡∏î‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠ ‡∏Å‡∏¥‡∏ô‡πÅ‡∏°‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏ô‡∏¥‡∏î",
    management:["‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ","‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏¥‡∏ô/‡πÅ‡∏õ‡∏•‡∏á‡∏î‡∏≠‡∏Å","‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ï‡∏±‡∏ß‡∏´‡πâ‡∏≥‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ"] },
  "Mealybugs - ‡πÄ‡∏û‡∏•‡∏µ‡πâ‡∏¢‡πÅ‡∏õ‡πâ‡∏á":{ type:"pest", label:"‡πÅ‡∏°‡∏•‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä",
    info:"‡∏î‡∏π‡∏î‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡∏ä‡πÅ‡∏Ñ‡∏£‡∏∞‡πÅ‡∏Å‡∏£‡πá‡∏ô ‡πÉ‡∏ö‡∏´‡∏á‡∏¥‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏£‡∏≤‡∏î‡∏≥‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô (‡∏Æ‡∏±‡∏ô‡∏ô‡∏µ‡∏î‡∏¥‡∏ß)",
    management:["‡∏ä‡∏µ‡∏ß‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ö‡∏¥‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢/‡πÄ‡∏°‡∏ò‡∏≤‡πÑ‡∏£‡πÄ‡∏ã‡∏µ‡∏¢‡∏°","‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°‡∏Ñ‡∏ß‡∏±‡∏ô‡πÑ‡∏°‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏™‡∏∞‡πÄ‡∏î‡∏≤","‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ï‡∏±‡∏ß‡∏´‡πâ‡∏≥‡πÄ‡∏ä‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏á‡πÄ‡∏ï‡πà‡∏≤‡∏•‡∏≤‡∏¢/‡πÅ‡∏ï‡∏ô‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô"] },
  "Cutworm - ‡∏´‡∏ô‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ":{ type:"pest", label:"‡πÅ‡∏°‡∏•‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä",
    info:"‡∏Å‡∏±‡∏î‡∏Å‡∏¥‡∏ô‡πÉ‡∏ö ‡∏¢‡∏≠‡∏î‡∏≠‡πà‡∏≠‡∏ô ‡∏î‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ú‡∏• ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÄ‡∏£‡πá‡∏ß",
    management:["‡πÉ‡∏ä‡πâ Bt ‡∏â‡∏µ‡∏î‡∏û‡πà‡∏ô","‡∏Å‡∏±‡∏ö‡∏î‡∏±‡∏Å‡∏ü‡∏µ‡πÇ‡∏£‡πÇ‡∏°‡∏ô‡∏•‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏¢","‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏õ‡∏•‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏Ç‡πà/‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≠‡∏ô‡∏ó‡∏≥‡∏•‡∏≤‡∏¢"] },
  "Striped Flea Beetle - ‡∏î‡πâ‡∏ß‡∏á‡∏´‡∏°‡∏±‡∏î‡∏ú‡∏±‡∏Å‡πÅ‡∏ñ‡∏ö‡∏•‡∏≤‡∏¢":{ type:"pest", label:"‡πÅ‡∏°‡∏•‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä",
    info:"‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏¢‡∏Å‡∏±‡∏î‡πÉ‡∏ö‡∏û‡∏£‡∏∏‡∏ô ‡∏ï‡∏±‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏î‡∏£‡∏≤‡∏Å ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡∏ä‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•‡∏Å‡∏∞‡∏´‡∏•‡πà‡∏≥",
    management:["‡∏ï‡∏≤‡∏Ç‡πà‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡πÅ‡∏°‡∏•‡∏á","‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏™‡∏∞‡πÄ‡∏î‡∏≤/‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°‡∏Ñ‡∏ß‡∏±‡∏ô‡πÑ‡∏°‡πâ","‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô"] },
  "‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÑ‡∏´‡∏°‡πâ - Leaf Blight":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÑ‡∏´‡∏°‡πâ",
    info:"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ Exserohilum turcicum ‡πÅ‡∏ú‡∏•‡∏¢‡∏≤‡∏ß‡∏£‡∏µ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡∏û‡∏ö‡∏°‡∏≤‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏∑‡πâ‡∏ô",
    management:["‡πÉ‡∏ä‡πâ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô","‡∏õ‡∏•‡∏π‡∏Å‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏ó‡∏µ‡πà","‡∏ï‡∏±‡∏î‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ","‡∏â‡∏µ‡∏î‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"] },
  "‡πÇ‡∏£‡∏Ñ‡∏£‡∏≤‡∏™‡∏ô‡∏¥‡∏° - Common Rust":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡∏£‡∏≤‡∏™‡∏ô‡∏¥‡∏°",
    info:"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ Puccinia sorghi ‡∏à‡∏∏‡∏î‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏™‡∏ô‡∏¥‡∏°‡∏ö‡∏ô‡πÉ‡∏ö",
    management:["‡πÉ‡∏ä‡πâ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô","‡∏õ‡∏•‡∏π‡∏Å‡πÑ‡∏°‡πà‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô","‡∏â‡∏µ‡∏î‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏î"] },
  "‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á - Yellow Leaf":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πâ‡∏≠‡∏¢",
    info:"‡πÑ‡∏ß‡∏£‡∏±‡∏™ SCYLV ‡πÉ‡∏ö‡πÅ‡∏Å‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏•‡∏á‡πÇ‡∏Ñ‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏•‡∏î‡∏•‡∏á",
    management:["‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏õ‡∏•‡∏≠‡∏î‡πÇ‡∏£‡∏Ñ","‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏û‡∏•‡∏µ‡πâ‡∏¢‡∏≠‡πà‡∏≠‡∏ô‡∏û‡∏≤‡∏´‡∏∞","‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ó‡∏¥‡πâ‡∏á","‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏≤‡∏î"] },
  "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ô‡πà‡∏≤‡πÅ‡∏î‡∏á - Red Rot":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ô‡πà‡∏≤‡πÅ‡∏î‡∏á",
    info:"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ Colletotrichum falcatum ‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏¢‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏ä‡∏°‡∏û‡∏π ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏≠‡πâ‡∏≠‡∏¢‡πÄ‡∏ô‡πà‡∏≤‡πÅ‡∏î‡∏á",
    management:["‡∏ó‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏™‡∏∞‡∏≠‡∏≤‡∏î","‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏π‡∏Å‡∏ã‡πâ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°","‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏î‡∏µ","‡πÄ‡∏ú‡∏≤‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ","‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"] },
  "‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÑ‡∏´‡∏°‡πâ - Cassava Bacterial Blight":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡πÑ‡∏´‡∏°‡πâ‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢",
    info:"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ Xanthomonas ‡πÉ‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏â‡πà‡∏≥‡∏ô‡πâ‡∏≥ ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà ‡πÉ‡∏ö‡∏£‡πà‡∏ß‡∏á",
    management:["‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏™‡∏∞‡∏≠‡∏≤‡∏î","‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ó‡∏¥‡πâ‡∏á","‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏•‡∏π‡∏Å‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏î","‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢"] },
  "‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏î‡πà‡∏≤‡∏á - Cassava Mosaic":{ type:"disease", label:"‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ö‡∏î‡πà‡∏≤‡∏á",
    info:"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏ß‡∏£‡∏±‡∏™ CMV ‡πÉ‡∏ö‡∏î‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ö‡∏´‡∏î‡∏ö‡∏¥‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß ‡∏ï‡πâ‡∏ô‡πÅ‡∏Ñ‡∏£‡∏∞‡πÅ‡∏Å‡∏£‡πá‡∏ô",
    management:["‡πÉ‡∏ä‡πâ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô","‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏°‡∏•‡∏á‡∏´‡∏ß‡∏µ‡πà‡∏Ç‡∏≤‡∏ß‡∏û‡∏≤‡∏´‡∏∞","‡∏ñ‡∏≠‡∏ô‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ","‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏î"] },
  "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡πÉ‡∏ö - Healthy Leaf":{ type:"healthy", label:"‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ",
    info:"‡∏û‡∏∑‡∏ä‡∏°‡∏µ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
    management:["‡∏î‡∏π‡πÅ‡∏•‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥","‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏û‡∏∑‡∏ä‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥"] },
  "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏î‡πâ":{ type:"unknown", label:"‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó",
    info:"‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•",
    management:[] }
};

/* ================== GLOBAL (‡πÄ‡∏î‡∏¥‡∏° + ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞ direct) =================== */
let currentModelKey = null;
let currentModel = null;
let lastPrediction = null;
let capturedImageDataUrl = null;

let dcImageDataUrl = null; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Direct Contribution

const CONF_LIMIT = 0.80;
const UNKNOWN_NAME = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏î‡πâ";

/* Helpers */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

function updateNavVisibility(activeId){
  const top = document.getElementById('top-nav');
  if (!top) return;
  top.style.display = (activeId === 'home-page') ? 'none' : '';
}

function setActivePage(id){
  $$('.page-section').forEach(el=>el.classList.remove('active'));
  $('#'+id).classList.add('active');
  $$('#top-nav a').forEach(a=>{
    a.classList.toggle('active', a.dataset.target===id);
    if(['result-page','report-feedback-page'].includes(a.dataset.target)){
      a.style.display = (id===a.dataset.target) ? 'inline-flex'
        : (id==='result-page' && a.dataset.target==='report-feedback-page' ? 'inline-flex'
        : (id==='report-feedback-page' && a.dataset.target==='result-page' ? 'inline-flex':'none'));
    }
  });
  updateNavVisibility(id);
}

/* Resize to 224√ó224 for model (‡πÄ‡∏î‡∏¥‡∏°) */
function toModelCanvasFromImage(img){
  const c=document.createElement('canvas');
  c.width=224; c.height=224;
  c.getContext('2d').drawImage(img,0,0,224,224);
  return c;
}

/* ====== MODEL (‡πÄ‡∏î‡∏¥‡∏°) ====== */
async function loadModel(url){
  $('#loading').style.display='flex';
  try{
    const m = await tmImage.load(url+'model.json', url+'metadata.json');
    return m;
  }catch(e){
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÑ‡∏î‡πâ');
    console.error(e);
    return null;
  }finally{
    $('#loading').style.display='none';
  }
}

async function initWebcam(){
  $('#loading').style.display='flex';
  const v = $('#webcam');
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1280},height:{ideal:720}}});
    v.srcObject = stream;
    v.style.display='block';
    $('#placeholder').style.display='none';
  }catch(e){
    console.warn(e);
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÅ‡∏ó‡∏ô');
  }finally{$('#loading').style.display='none';}
}

function captureFromWebcam(){
  const v = $('#webcam');
  const c = document.createElement('canvas');
  c.width=v.videoWidth; c.height=v.videoHeight;
  c.getContext('2d').drawImage(v,0,0,c.width,c.height);
  capturedImageDataUrl = c.toDataURL('image/jpeg');
  showPreview(capturedImageDataUrl);
}

function showPreview(dataURL){
  const img = $('#preview');
  img.src=dataURL; img.style.display='block';
  $('#webcam').style.display='none';
  $('#placeholder').style.display='none';
  $('#analyze').style.display='inline-flex';
  $('#recapture').style.display='inline-flex';
}

async function analyze(){
  if(!capturedImageDataUrl){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô'); return; }
  if(!currentModel){ alert('‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà'); return; }

  $('#loading').style.display='flex';
  try{
    const tmpImg = new Image(); tmpImg.src = capturedImageDataUrl; await tmpImg.decode();
    const modelInputCanvas = toModelCanvasFromImage(tmpImg);
    const prediction = await currentModel.predict(modelInputCanvas);
    prediction.sort((a,b)=>b.probability-a.probability);
    lastPrediction = prediction;

    renderResult(prediction[0]);
    setActivePage('result-page');
  }catch(e){
    console.error(e); alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û');
  }finally{$('#loading').style.display='none'}
}

/* ====== RESULT RENDER (‡πÄ‡∏î‡∏¥‡∏°) ====== */
function renderResult(top){
  $('#result-image').src = capturedImageDataUrl;
  const percent = Math.round(top.probability*100);
  const confident = top.probability >= CONF_LIMIT;
  const isUnknown = top.className === UNKNOWN_NAME;

  let d = RESULTS_DATA[top.className] || {type:'unknown',label:'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'};
  const typeEl = $('#result-type');
  typeEl.className = 'badge '+(d.type||'unknown');
  typeEl.innerHTML = `<i class="fa-solid fa-tag"></i><b>${d.label}</b>`;
  $('#result-name').textContent = confident ? top.className : (isUnknown ? UNKNOWN_NAME : top.className);

  $('#conf-fill').style.width = (confident?percent:Math.max(percent,5))+'%';
  $('#result-confidence').textContent = confident ? `${percent}%` : '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠';

  const infoBox = $('#result-info');
  if(isUnknown || !confident){
    infoBox.innerHTML = `
      <div class="unknown-box">
        <div class="adv"><i class="fa-solid fa-eye-slash"></i> ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡πÅ‡∏™‡∏á‡∏ô‡πâ‡∏≠‡∏¢/‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</div>
        <div class="adv"><i class="fa-solid fa-image"></i> ‡∏°‡∏∏‡∏°‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î</div>
        <div class="adv"><i class="fa-solid fa-database"></i> ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•</div>
      </div>`;
  }else{
    infoBox.innerHTML = `
      <div class="block">
        <h4><i class="fa-solid fa-circle-info"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h4>
        <p>${d.info || '-'}</p>
        <h4><i class="fa-solid fa-clipboard-check"></i>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</h4>
        <ul class="list">
          ${(d.management||[]).map(t=>`<li><i class="fa-solid fa-check-circle"></i>${t}</li>`).join('')}
        </ul>
      </div>
    `;
  }

  const near = lastPrediction
    .filter(p => p.className !== UNKNOWN_NAME && (!confident ? true : p.className !== top.className))
    .slice(0, 3)
    .map(p => `<li><i class="fa-regular fa-circle-check"></i> ${p.className} ‚Äì ${Math.round(p.probability*100)}%</li>`)
    .join('');
  $('#nearby-list').innerHTML = near;

  $('#report-img').src = capturedImageDataUrl;
  $('#ai-summary').textContent = confident && !isUnknown ? top.className : UNKNOWN_NAME;
}

/* ====== NAV / EVENTS (‡πÄ‡∏î‡∏¥‡∏° + ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà) ====== */
function bindNav(){
  $$('#top-nav a').forEach(a=>{
    a.addEventListener('click',e=>{
      e.preventDefault();
      setActivePage(a.dataset.target);
    });
  });
}

function bindHomeCards(){
  $$('.feature').forEach(card=>{
    card.addEventListener('click', async ()=>{
      const key = card.dataset.model;
      currentModelKey = key;
      const mInfo = MODELS_INFO[key];
      $('#analysis-title').textContent = mInfo.title;
      $('#instruction').textContent = mInfo.instruction;

      if(!currentModel || currentModel.url !== mInfo.url){
        currentModel = await loadModel(mInfo.url);
      }
      await initWebcam();
      setActivePage('analysis-page');
    });
  });

  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Direct Contribution (‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
  $('#contribute-data-home').addEventListener('click',()=>setActivePage('direct-contrib-page'));
}

function bindAnalysisButtons(){
  $('#capture').addEventListener('click',captureFromWebcam);
  $('#upload').addEventListener('click',()=>$('#file-input').click());
  $('#file-input').addEventListener('change',e=>{
    if(e.target.files?.length){
      const file=e.target.files[0];
      const r=new FileReader();
      r.onload=ev=>{ capturedImageDataUrl=ev.target.result; showPreview(capturedImageDataUrl); };
      r.readAsDataURL(file);
    }
  });
  $('#analyze').addEventListener('click',analyze);
  $('#recapture').addEventListener('click',()=>{
    $('#preview').style.display='none'; $('#webcam').style.display='block';
    $('#analyze').style.display='none'; $('#recapture').style.display='none';
  });
}

function bindResultButtons(){
  $('#again').addEventListener('click',()=>setActivePage('analysis-page'));
  $('#go-report').addEventListener('click',()=>setActivePage('report-feedback-page'));
  $('#back-to-result').addEventListener('click',()=>setActivePage('result-page'));
}

/* ================== GOOGLE APPS SCRIPT (‡πÄ‡∏î‡∏¥‡∏°) =================== */
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzxMcdkHDEBPv5aspReCHxOW6lh_Y00O3wWQLpeIR43KhKNjV70Cli9z9fuK4GRHNV7/exec';

async function submitData(payload){
  try{
    payload.timestamp = new Date().toISOString();
    await fetch(GAS_URL,{
      method:'POST',mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    return true;
  }catch(err){
    console.error(err);
    return false;
  }
}

/* ===== ‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‚Äù ‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡πÄ‡∏î‡∏¥‡∏°) ===== */
$('#send-report').addEventListener('click',async ()=>{
  const ai = $('#ai-summary').textContent.trim();
  const fix = $('#fix-name').value.trim();
  const desc= $('#desc').value.trim();
  const payload = {
    type:'report',
    category: currentModelKey,
    imageData: capturedImageDataUrl,
    aiPrediction: ai,
    aiConfidence: (lastPrediction && lastPrediction[0]) ? lastPrediction[0].probability.toFixed(4) : '',
    userCorrection: fix,
    userDescription: desc
  };
  const ok = await submitData(payload);
  alert(ok ? '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI!' : '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
  setActivePage('home-page');
});

/* ===== ‡πÉ‡∏´‡∏°‡πà: DIRECT CONTRIBUTION (‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô) ===== */
function bindDirectContribution(){
  const uploadBtn = $('#dc-upload');
  const fileInput = $('#dc-file');
  const preview   = $('#dc-preview');
  const clearBtn  = $('#dc-clear');
  const modal     = $('#dc-modal');
  const modalOk   = $('#dc-ok');

  uploadBtn.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', (e)=>{
    if(e.target.files?.length){
      const f=e.target.files[0];
      const r=new FileReader();
      r.onload=ev=>{
        dcImageDataUrl = ev.target.result;
        preview.src = dcImageDataUrl;
        preview.style.display='block';
        clearBtn.style.display='inline-flex';
      };
      r.readAsDataURL(f);
    }
  });

  clearBtn.addEventListener('click', ()=>{
    fileInput.value='';
    dcImageDataUrl=null;
    preview.style.display='none';
    clearBtn.style.display='none';
  });

  $('#dc-back').addEventListener('click', ()=> setActivePage('home-page'));

  // ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö ‚Äú‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‚Äù
  $('#dc-send').addEventListener('click', async ()=>{
    if(!dcImageDataUrl){ alert('‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô'); return; }
    if(!$('#dc-consent').checked){ alert('‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'); return; }

    const note = $('#dc-note').value.trim();

    const payload = {
      type: 'report',
      category: $('#dc-category').value,
      imageData: dcImageDataUrl,
      aiPrediction: '',
      aiConfidence: '',
      userCorrection: $('#dc-true').value.trim(),
      userDescription: note
    };

    const ok = await submitData(payload);
    if(ok){
      modal.style.display='flex';
      modalOk.focus();
      // reset ‡∏ü‡∏≠‡∏£‡πå‡∏°
      $('#dc-true').value=''; $('#dc-note').value='';
      $('#dc-consent').checked=false;
      fileInput.value=''; dcImageDataUrl=null; preview.style.display='none'; clearBtn.style.display='none';
    }else{
      alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    }
  });

  modalOk.addEventListener('click', ()=>{
    $('#dc-modal').style.display='none';
    setActivePage('home-page');
  });
}

/* ================== INIT =================== */
document.addEventListener('DOMContentLoaded', ()=>{
  updateNavVisibility('home-page');

  bindNav();
  bindHomeCards();
  bindAnalysisButtons();
  bindResultButtons();
  bindDirectContribution();  // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Direct Contribution

  // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå/‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏• (‡πÄ‡∏î‡∏¥‡∏°)
  $$('#top-nav a').forEach(a=>{
    if(['result-page','report-feedback-page'].includes(a.dataset.target)) a.style.display='none';
  });
});
</script>
</body>
</html>
